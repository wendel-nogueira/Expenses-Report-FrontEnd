<div class="flex flex-col gap-8 mt-20">
  <div>
    <h2 class="text-2xl text-center text-slate-900 mb-2">update departament</h2>
    <p class="text-center font-light text-slate-500">
      use the form below to update the departament
    </p>
  </div>

  <div
    class="flex flex-col gap-6 items-center py-16 px-0 bg-white rounded-md mx-auto shadow-md"
  >
    <form class="w-4/5 flex flex-col gap-5" *ngIf="!loading && departament">
      <mat-form-field class="w-full">
        <mat-label>Name</mat-label>
        <input
          type="text"
          matInput
          [formControl]="nameFormControl"
          [errorStateMatcher]="matcher"
          placeholder="Ex. Departament X"
          minlength="2"
          maxlength="50"
          name="name"
        />
        <mat-error
          *ngIf="
            nameFormControl.hasError('minlength') ||
            nameFormControl.hasError('maxlength')
          "
          class="font-normal text-xs mt-1"
        >
          Name must be between <strong class="font-bold">2</strong> and
          <strong class="font-bold">50</strong> characters
        </mat-error>
        <mat-error
          *ngIf="nameFormControl.hasError('required')"
          class="font-normal text-xs mt-1"
        >
          Name is <strong class="font-bold">required</strong>
        </mat-error>
      </mat-form-field>

      <mat-form-field class="w-full">
        <mat-label>Acronym</mat-label>
        <input
          type="text"
          matInput
          [formControl]="acronymFormControl"
          [errorStateMatcher]="matcher"
          placeholder="Ex. DEPX"
          minlength="2"
          maxlength="10"
          name="acronym"
          (change)="onAcronymChange()"
        />
        <mat-error
          *ngIf="
            !acronymFormControl.hasError('required') &&
            !acronymFormControl.hasError('minlength') &&
            !acronymFormControl.hasError('maxlength')
          "
          class="font-normal text-xs mt-1"
        >
          Acronym already exists
        </mat-error>
        <mat-error
          *ngIf="
            acronymFormControl.hasError('minlength') ||
            acronymFormControl.hasError('maxlength')
          "
          class="font-normal text-xs mt-1"
        >
          Acronym must be between <strong class="font-bold">2</strong> and
          <strong class="font-bold">10</strong> characters
        </mat-error>
        <mat-error
          *ngIf="
            acronymFormControl.hasError('minlength') ||
            acronymFormControl.hasError('maxlength')
          "
          class="font-normal text-xs mt-1"
        >
          Acronym must be between <strong class="font-bold">2</strong> and
          <strong class="font-bold">10</strong> characters
        </mat-error>
        <mat-error
          *ngIf="acronymFormControl.hasError('required')"
          class="font-normal text-xs mt-1"
        >
          Acronym is <strong class="font-bold">required</strong>
        </mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Description</mat-label>
        <textarea
          [formControl]="descriptionFormControl"
          [errorStateMatcher]="matcher"
          matInput
          maxlength="200"
        ></textarea>
      </mat-form-field>

      <div class="flex items-center gap-3">
        <mat-form-field class="w-full">
          <mat-label>Managers</mat-label>
          <mat-select
            multiple
            [formControl]="managersFormControl"
            (selectionChange)="onChangeManagers()"
            [(value)]="managersToUpdate"
          >
            <mat-option *ngFor="let user of allUsers" [value]="user.id">{{
              user.name.firstName + ' ' + user.name.lastName
            }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="flex items-center gap-3">
        <mat-form-field class="w-full">
          <mat-label>Users</mat-label>
          <mat-select
            multiple
            [formControl]="usersFormControl"
            (selectionChange)="onChangeUsers()"
            [(value)]="usersToUpdate"
          >
            <mat-option *ngFor="let user of allUsers" [value]="user.id">{{
              user.name.firstName + ' ' + user.name.lastName
            }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="flex items-center justify-center gap-8">
        <button
          mat-flat-button
          class="text-white rounded transition-colors mat-elevation-z2 flex justify-normal items-center py-2 px-3 bg-blue-400 hover:bg-blue-500 mat-elevation-z2"
          type="submit"
          (click)="onSubmit()"
        >
          <mat-icon svgIcon="edit" class="text-white"></mat-icon>
          <span class="ml-2">update</span>
        </button>
        <a [routerLink]="['/departaments']">
          <button
            mat-flat-button
            class="text-white rounded transition-colors mat-elevation-z2 flex justify-normal items-center py-2 px-3 bg-red-400 hover:bg-red-500 mat-elevation-z2"
          >
            <mat-icon svgIcon="cancel" class="text-white"></mat-icon>
            <span class="ml-2">cancel</span>
          </button>
        </a>
        <button
          mat-flat-button
          class="text-white rounded transition-colors mat-elevation-z2 flex justify-normal items-center py-2 px-3 bg-orange-400 hover:bg-orange-500 mat-elevation-z2"
          (click)="onDeactivate()"
          *ngIf="departament && !departament.isDeleted"
        >
          <mat-icon svgIcon="trash" class="text-white"></mat-icon>
          <span class="ml-2">deactivate</span>
        </button>
        <button
          mat-flat-button
          class="text-white rounded transition-colors mat-elevation-z2 flex justify-normal items-center py-2 px-3 bg-green-400 hover:bg-green-500 mat-elevation-z2"
          (click)="onActivate()"
          *ngIf="departament && departament.isDeleted"
        >
          <mat-icon svgIcon="check" class="text-white"></mat-icon>
          <span class="ml-2">activate</span>
        </button>
      </div>
    </form>
    <div class="flex flex-col items-center justify-center" *ngIf="loading">
      <mat-spinner
        *ngIf="loading"
        class="w-16 h-16 text-center mx-auto"
        [diameter]="60"
        [strokeWidth]="5"
      ></mat-spinner>
    </div>
  </div>
</div>
